const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/katex.B82Si5CG.css","_astro/fancybox.DRe9SoLl.css"])))=>i.map(i=>d[i]);
import{_ as v}from"./preload-helper.BlTxHScW.js";import{p as D,u as P}from"./url-utils.BdmGdF_z.js";import{c as F,D as H}from"./constants.D4k-FYC3.js";import{w as q,a as z}from"./config.BX3EyYwE.js";import"./zh_TW.Byhae0TY.js";class O{x;y;s;r;a;fn;idx;img;limitArray;config;constructor(t,e,i,a,s,l,c,d,h,u){this.x=t,this.y=e,this.s=i,this.r=a,this.a=s,this.fn=l,this.idx=c,this.img=d,this.limitArray=h,this.config=u}draw(t){t.save(),t.translate(this.x,this.y),t.rotate(this.r),t.globalAlpha=this.a,t.drawImage(this.img,0,0,40*this.s,40*this.s),t.restore()}update(){this.x=this.fn.x(this.x,this.y),this.y=this.fn.y(this.y,this.y),this.r=this.fn.r(this.r),this.a=this.fn.a(this.a),(this.x>window.innerWidth||this.x<0||this.y>window.innerHeight||this.y<0||this.a<=0)&&(this.limitArray[this.idx]===-1?this.resetPosition():this.limitArray[this.idx]>0&&(this.resetPosition(),this.limitArray[this.idx]--))}resetPosition(){this.r=o("fnr",this.config),Math.random()>.4?(this.x=o("x",this.config),this.y=0,this.s=o("s",this.config),this.r=o("r",this.config),this.a=o("a",this.config)):(this.x=window.innerWidth,this.y=o("y",this.config),this.s=o("s",this.config),this.r=o("r",this.config),this.a=o("a",this.config))}}class N{list;constructor(){this.list=[]}push(t){this.list.push(t)}update(){for(let t=0,e=this.list.length;t<e;t++)this.list[t].update()}draw(t){for(let e=0,i=this.list.length;e<i;e++)this.list[e].draw(t)}get(t){return this.list[t]}size(){return this.list.length}}function o(n,t){let e,i;switch(n){case"x":e=Math.random()*window.innerWidth;break;case"y":e=Math.random()*window.innerHeight;break;case"s":e=t.size.min+Math.random()*(t.size.max-t.size.min);break;case"r":e=Math.random()*6;break;case"a":e=t.opacity.min+Math.random()*(t.opacity.max-t.opacity.min);break;case"fnx":i=t.speed.horizontal.min+Math.random()*(t.speed.horizontal.max-t.speed.horizontal.min),e=(a,s)=>a+i;break;case"fny":i=t.speed.vertical.min+Math.random()*(t.speed.vertical.max-t.speed.vertical.min),e=(a,s)=>s+i;break;case"fnr":e=a=>a+t.speed.rotation;break;case"fna":e=a=>a-t.speed.fadeSpeed*.01;break}return e}class W{config;canvas=null;ctx=null;sakuraList=null;animationId=null;img=null;isRunning=!1;constructor(t){this.config=t}async init(){!this.config.enable||this.isRunning||(this.img=new Image,this.img.src="/sakura.png",await new Promise((t,e)=>{this.img&&(this.img.onload=()=>t(),this.img.onerror=()=>e(new Error("Failed to load sakura image")))}),this.createCanvas(),this.createSakuraList(),this.startAnimation(),this.isRunning=!0)}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.height=window.innerHeight,this.canvas.width=window.innerWidth,this.canvas.setAttribute("style",`position: fixed; left: 0; top: 0; pointer-events: none; z-index: ${this.config.zIndex};`),this.canvas.setAttribute("id","canvas_sakura"),document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",this.handleResize.bind(this))}createSakuraList(){if(!this.img||!this.ctx)return;this.sakuraList=new N;const t=new Array(this.config.sakuraNum).fill(this.config.limitTimes);for(let e=0;e<this.config.sakuraNum;e++){const i=o("x",this.config),a=o("y",this.config),s=o("s",this.config),l=o("r",this.config),c=o("a",this.config),d=o("fnx",this.config),h=o("fny",this.config),u=o("fnr",this.config),b=o("fna",this.config),m=new O(i,a,s,l,c,{x:d,y:h,r:u,a:b},e,this.img,t,this.config);m.draw(this.ctx),this.sakuraList.push(m)}}startAnimation(){if(!this.ctx||!this.canvas||!this.sakuraList)return;const t=()=>{!this.ctx||!this.canvas||!this.sakuraList||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.sakuraList.update(),this.sakuraList.draw(this.ctx),this.animationId=requestAnimationFrame(t))};this.animationId=requestAnimationFrame(t)}handleResize(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight)}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.canvas&&(document.body.removeChild(this.canvas),this.canvas=null),window.removeEventListener("resize",this.handleResize.bind(this)),this.isRunning=!1}toggle(){this.isRunning?this.stop():this.init()}updateConfig(t){const e=this.isRunning;e&&this.stop(),this.config=t,e&&t.enable&&this.init()}getIsRunning(){return this.isRunning}}let E=null;function X(n){E?E.updateConfig(n):(E=new W(n),n.enable&&E.init())}const I=35,R=30,V=I+R,f=(n,t)=>window.setTimeout(n,t),T=!!document.getElementById("banner-wrapper");async function Y(){try{let n=function(e,i){document.addEventListener("click",async a=>{let s=a.target;if(s instanceof Node){for(let l of i){let c=document.getElementById(l);if(c==s||c?.contains(s))return}await t.closePanel(e)}})};const{panelManager:t}=await v(async()=>{const{panelManager:e}=await import("./panel-manager.BYknToDe.js");return{panelManager:e}},[]);return n("display-setting",["display-setting","display-settings-switch"]),n("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]),n("search-panel",["search-panel","search-bar","search-switch"]),n("mobile-toc-panel",["mobile-toc-panel","mobile-toc-switch"]),n("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]),t}catch(n){return console.error("Failed to initialize panel manager:",n),null}}Y();function G(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(t=>{if(!t.parentNode)return;const e=document.createElement("div");e.className="katex-display-container",t.parentNode.insertBefore(e,t),e.appendChild(t),e.style.cssText=`
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(0,0,0,0.3) transparent;
        `;const i=document.createElement("style");i.textContent=`
            .katex-display-container::-webkit-scrollbar {
                height: 6px;
            }
            .katex-display-container::-webkit-scrollbar-track {
                background: transparent;
            }
            .katex-display-container::-webkit-scrollbar-thumb {
                background: rgba(0,0,0,0.3);
                border-radius: 3px;
            }
            .katex-display-container::-webkit-scrollbar-thumb:hover {
                background: rgba(0,0,0,0.5);
            }
        `,document.head.querySelector("style[data-katex-scrollbar]")||(i.setAttribute("data-katex-scrollbar","true"),document.head.appendChild(i)),t.setAttribute("data-scrollbar-initialized","true")})}function B(){requestAnimationFrame(()=>{const n=document.getElementById("banner");n&&n.classList.remove("opacity-0","scale-105");const t=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');t&&!document.getElementById("banner-carousel")&&(t.classList.remove("opacity-0","scale-105"),t.classList.add("opacity-100")),document.getElementById("banner-carousel")&&U()})}function U(){const n=document.querySelectorAll(".carousel-item"),t=window.innerWidth<1024,e=Array.from(n).filter(i=>t?i.querySelector(".block.lg\\:hidden"):i.querySelector(".hidden.lg\\:block"));if(e.length>1&&z.banner.carousel?.enable){let i=function(r){const p=e[s];p.classList.remove("opacity-100","scale-100"),p.classList.add("opacity-0","scale-110"),s=r;const g=e[s];g.classList.add("opacity-100","scale-100"),g.classList.remove("opacity-0","scale-110")},a=function(){clearInterval(c),c=setInterval(()=>{if(!d){const r=(s+1)%e.length;i(r)}},l*1e3)},s=0;const l=z.banner.carousel?.interval||6;let c,d=!1,h=0,u=0,b=!1;const m=document.getElementById("banner-carousel");n.forEach(r=>{r.classList.add("opacity-0","scale-110"),r.classList.remove("opacity-100","scale-100")}),e.length>0&&(e[0].classList.add("opacity-100","scale-100"),e[0].classList.remove("opacity-0","scale-110")),m&&"ontouchstart"in window&&(m.addEventListener("touchstart",r=>{h=r.touches[0].clientX,u=r.touches[0].clientY,b=!1,d=!0,clearInterval(c)},{passive:!0}),m.addEventListener("touchmove",r=>{if(!h||!u)return;const p=Math.abs(r.touches[0].clientX-h),g=Math.abs(r.touches[0].clientY-u);p>g&&p>30&&(b=!0,r.preventDefault())},{passive:!1}),m.addEventListener("touchend",r=>{if(!h||!u||!b){d=!1,a();return}const p=r.changedTouches[0].clientX,g=h-p;if(Math.abs(g)>50)if(g>0){const A=(s+1)%e.length;i(A)}else{const A=(s-1+e.length)%e.length;i(A)}h=0,u=0,b=!1,d=!1,a()},{passive:!0})),m&&(m.addEventListener("mouseenter",()=>{d=!0,clearInterval(c)}),m.addEventListener("mouseleave",()=>{d=!1,a()})),a()}}function C(){const n=q?.sakura;!n||!n.enable||window.sakuraInitialized||(X(n),window.sakuraInitialized=!0)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",C):C();let y=[],w;function k(){document.querySelector(".katex")&&v(()=>Promise.resolve({}),__vite__mapDeps([0]))}async function L(){const n=".custom-md img, #post-cover img, .moment-images img",t=".moment-images a[data-fancybox]",e="[data-fancybox]:not(.moment-images a)";if(!(document.querySelector(n)||document.querySelector(t)||document.querySelector(e))||(w||(w=(await v(()=>import("./index.D26FdS83.js"),[])).Fancybox,await v(()=>Promise.resolve({}),__vite__mapDeps([1]))),y.length>0))return;const a={Thumbs:{autoStart:!0,showOnStart:"yes"},Toolbar:{display:{left:["infobar"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"],right:["slideshow","thumbs","close"]}},animated:!0,dragToClose:!0,keyboard:{Escape:"close",Delete:"close",Backspace:"close",PageUp:"next",PageDown:"prev",ArrowUp:"next",ArrowDown:"prev",ArrowRight:"next",ArrowLeft:"prev"},fitToView:!0,preload:3,infinite:!0,Panzoom:{maxScale:3,minScale:1},caption:!1};w.bind(n,{...a,groupAll:!0,Carousel:{transition:"slide",preload:2}}),y.push(n),w.bind(t,{...a,source:s=>s.getAttribute("data-src")||s.getAttribute("href")}),y.push(t),w.bind(e,a),y.push(e)}function K(){w&&(y.forEach(n=>{w.unbind(n)}),y=[])}const M=()=>{window.swup.hooks.on("link:click",()=>{if(document.documentElement.style.setProperty("--content-delay","0ms"),T){const n=document.getElementById("navbar-wrapper");if(n&&document.body.classList.contains("lg:is-home")){const t=window.innerHeight*(I/100)-88;document.documentElement.scrollTop>=t&&n.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{if(L(),k(),G(),document.getElementById("toc-wrapper")!==null){const i=document.querySelector("table-of-contents");i&&typeof i.init=="function"&&f(()=>{i.init()},100),typeof window.mobileTOCInit=="function"&&f(()=>{window.mobileTOCInit()},100)}const e=document.getElementById("navbar");e&&e.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection()}),window.swup.hooks.on("visit:start",n=>{K();const t=document.querySelector("body"),e=D(n.to.url,P("/"));t&&(e?t.classList.add("lg:is-home"):t.classList.remove("lg:is-home"));const i=document.querySelector(".banner-text-overlay");i&&(e?i.classList.remove("hidden"):i.classList.add("hidden"));const a=document.getElementById("navbar");a&&(a.setAttribute("data-is-home",e.toString()),a.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection());const s=document.getElementById("banner-wrapper"),l=document.querySelector(".absolute.w-full.z-30");s&&l&&(e?(f(()=>{s.classList.remove("mobile-hide-banner")},100),f(()=>{l.classList.remove("mobile-main-no-banner")},150)):(s.classList.add("mobile-hide-banner"),f(()=>{l.classList.add("mobile-main-no-banner")},100)));const c=document.getElementById("page-height-extend");c&&c.classList.remove("hidden");let d=document.getElementById("toc-wrapper");d&&d.classList.add("toc-not-ready")}),window.swup.hooks.on("page:view",()=>{const n=document.getElementById("page-height-extend");n&&n.classList.remove("hidden"),window.scrollTo({top:0,behavior:"instant"});const e=(localStorage.getItem("theme")||F)===H,i=e?"github-dark":"github-light",a=document.documentElement.getAttribute("data-theme"),s=document.documentElement.classList.contains("dark");(a!==i||s!==e)&&requestAnimationFrame(()=>{a!==i&&document.documentElement.setAttribute("data-theme",i),s!==e&&(e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"))}),f(()=>{if(document.getElementById("tcomment")){const l=new CustomEvent("mizuki:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(l),console.log("Layout: 触发 mizuki:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",n=>{f(()=>{const t=document.getElementById("page-height-extend");t&&t.classList.add("hidden");const e=document.getElementById("toc-wrapper");e&&e.classList.remove("toc-not-ready")},200)})};window?.swup?.hooks?(L(),k(),M()):(document.addEventListener("swup:enable",M),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{L(),k()}):(L(),k()));let S=document.getElementById("back-to-top-btn"),x=document.getElementById("toc-wrapper"),_=document.getElementById("navbar-wrapper");function $(n,t){let e;return function(){const i=arguments,a=this;e||(n.apply(a,i),e=!0,f(()=>e=!1,t))}}function j(){const n=document.documentElement.scrollTop,t=window.innerHeight*(I/100);requestAnimationFrame(()=>{if(S&&(n>t?S.classList.remove("hide"):S.classList.add("hide")),T&&x&&(document.body.classList.contains("enable-banner")?n>t?x.classList.remove("toc-hide"):x.classList.add("toc-hide"):x.classList.remove("toc-hide")),T&&_){const i=document.body.classList.contains("lg:is-home")&&window.innerWidth>=1024?V:I,a=window.innerHeight*(i/100)-88;n>=a?_.classList.add("navbar-hidden"):_.classList.remove("navbar-hidden")}})}window.onscroll=$(j,16);window.onresize=()=>{let n=Math.floor(window.innerHeight*(R/100));n=n-n%4,document.documentElement.style.setProperty("--banner-height-extend",`${n}px`)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",async()=>{B();try{await v(()=>import("./panel-manager.BYknToDe.js"),[]),console.log("Panel manager initialized")}catch(n){console.error("Failed to initialize panel manager:",n)}}):(B(),(async()=>{try{await v(()=>import("./panel-manager.BYknToDe.js"),[]),console.log("Panel manager initialized")}catch(n){console.error("Failed to initialize panel manager:",n)}})());
